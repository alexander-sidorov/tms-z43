<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>–ó–∞–¥–∞–Ω–∏–µ 4.02</title>
</head>
<body>
<article>
    <p><a href="/">&lt;&lt;&lt;</a></p>
    <hr>
    <h1>–ó–∞–¥–∞–Ω–∏–µ 4.02</h1>
    <section>
        <h2>–£—Å–ª–æ–≤–∏–µ</h2>
        <p>–ü—Ä–æ—Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∏—Å–µ–ª, –≤–≤–æ–¥–∏–º—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.</p>
        <p>–°—É–º–º–∏—Ä–æ–≤–∞—Ç—å –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–≤–µ–¥—ë—Ç —Å–ª–æ–≤–æ "stop".</p>
        <form>
            <label for="id_number">–ß–∏—Å–ª–æ:</label>
            <input id="id_number" name="number" placeholder="88" type="number" value="$number">
            <button type="submit">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
        </form>
    </section>
    <section>
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
        <p>
            <span id="id_spinner" style="color: red">üåç</span>
            <span id="id_result">?</span>
        </p>
    </section>
</article>
<script>
    const getSum = () => {
        let api_url = `/api/v1/tasks/402/`;
        let element = document.getElementById("id_result");

        fetch(api_url, {
            method: "GET",
        }).then(
            response => {
                if (response.status === 200) {
                    response.json().then(
                        payload => {
                            if (payload.ok) {
                                element.textContent = payload.result;
                            } else {
                                console.log("ERROR (server declines request):", JSON.stringify(payload.reason));
                            }
                        }
                    ).catch(
                        error => {
                            console.log("ERROR (while parsing server response):", error);
                        }
                    );
                } else {
                    console.log("ERROR (with response):", response.status, response.statusText);
                }
            }
        ).catch(
            error => {
                console.log("ERROR (on fetch request):", error);
            }
        );
    }

    const thinking = () => {
        const glyphs = ["üåç", "üåè", "üåé",];
        let element = document.getElementById("id_spinner");

        let position = sessionStorage.getItem("glyph_position");
        if (!position) {
            position = 0;
        } else {
            position = parseInt(position);
        }
        position = position % glyphs.length;
        element.textContent = glyphs[position];
        sessionStorage.setItem("glyph_position", (position + 1).toString())
    }

    window.onload = () => {
        setInterval(getSum, 2000);
        setInterval(thinking, 500);
    };
</script>
</body>
</html>
